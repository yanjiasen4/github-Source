---
title: 使用红黑树实现一个map（二）
date: 2016-12-11 22:01:40
tags: [C++,map,数据结构,红黑树,RBTree]
categories: Data Structure
---

&#8195;&#8195;上一篇里把map的框架建好了，接下来几篇将会关注红黑树的实现。

<!-- more -->

# 红黑树的操作
在分析红黑树的操作前，我们再回顾一下红黑树的定义  

1. 每个节点都是红色或者黑色
2. 根（root）节点和叶子节点（NIL空节点）都是黑色
3. 红节点的子节点不能为红色
4. 从任一节点出发，到达其任一叶子节点的路径中所包含的黑色节点数目相同 

为了维持这一定义，红黑树的插入和删除都需要进行额外的调整。
不过，虽然调整的平均复杂度低于AVL树，但是写起来真是费劲。

## 插入
插入可以算是树最基本的操作了，对于红黑树来说，插入新的节点可能会破坏红黑树的规则，所以需要对树的结构进行调整。  
首先，新的节点将作为叶子节点被插入。考虑几种插入的情况：  
1. 插入节点为根节点： 直接将插入节点标记为黑色。
2. 插入节点的父节点为黑色： 将插入节点标记为红色，不影响红黑树的性质，结束。 

![figure1](http://ohvmg8dgt.bkt.clouddn.com/rbt_insert_case1-2.png)

上面两种情况显然是我们乐意看见的，处理起来十分简单，但是现实往往不是那么美好：如果插入节点的父节点是红色应该怎么办？  

![figure2](http://ohvmg8dgt.bkt.clouddn.com/rbt_insert_case3-intro.png)  

这个时候的树已经违反了红黑树的第三条性质，出现了连续两个红色节点，需要调整。
最直接的想法是将当前节点（3）或父节点（2）变为黑色，但是这样会影响到祖父节点（1）子树的高度，又可能造成规则的破坏。  

但是注意到由于父节点是红色，祖父节点一定是黑色。如果将父节点变为黑色后，将祖父节点变为红色，则不影响整棵树的平衡性。

......

除非叔叔节点是黑色。

如果叔叔节点是红色，那么将他跟父节点类似地染为黑色则解决了插入节点局部不符合红黑树性质的问题。
只需要将祖父节点当做一个插入节点，向上递归调用调整算法即可。
3. 插入节点的父节点为红色，叔叔节点也为红色：  
 交换父节点和祖父节点的颜色，将叔叔节点染为黑色，以祖父节点为新的插入节点向上递归。
 ![figure3](http://ohvmg8dgt.bkt.clouddn.com/rbt_inser_case3_1.png)  
 
那么如果叔叔节点是黑色呢？

